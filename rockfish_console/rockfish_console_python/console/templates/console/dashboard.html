<!DOCTYPE html>
<html>
<head>
    <!-- include head -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
     <title>Rockfish Console</title>
    <link rel="shortcut icon" href="static/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="static/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="http://cdno.axisj.com/axicon/axicon.min.css" />
    <link rel="stylesheet" type="text/css" href="http://cdno.axisj.com/axisj/ui/kakao/AXJ.min.css" id="axu-theme-axisj" />
    <script type="text/javascript" src="http://cdno.axisj.com/axisj/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdno.axisj.com/axisj/dist/AXJ.min.js"></script>
    <link rel="stylesheet" href="static/ui/cacao-dark/admin.css" id="axu-theme-admin" />
    <link rel="stylesheet" href="static/ui/custom.css" />
    <script type="text/javascript" src="static/resource/admin.js"></script>
    <script type="text/javascript" src="static/resource/Chart.min.js"></script>
    <script type="text/javascript" src="static/resource/jsencrypt.js"></script>
    <!-- include head -->
</head>
<body>
<div id="AXPage">
	<!-- ax-header : include -->
    <div class="ax-header">
        <div class="ax-wrap">
            <div class="ax-layer">
                <div class="ax-col-12">
                    <div class="ax-unit">
                        <div class="ax-logo">
                             <a href="dashboard.html"><span class="logo-img"><i><img src="static/images/logo_32x32.png" style="margin-top:7px"></i></span><span class="logo-txt">Rockfish Console</span></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ax-layer">
                <div class="ax-col-8">
                    <div class="ax-unit">
                        <!-- 상단 top-down-menu 표시 영역 : s-->
                        <div id="ax-top-menu" class="ax-top-menu AXMenuBox"></div>
                        <!-- e : 상단 top-down-menu 표시 영역 -->
                        <div class="mx-top-menu"><a id="mx-top-menu-handle" class="mx-menu-button"><i class="axi axi-th"></i></a></div>
                    </div>
                </div>
                <div class="ax-col-4">
                    <div class="ax-unit">
                        <ul class="ax-loginfo" id="ax-loginfo">
                            <li class="profile"><div class="photo"></div></li>
                            <li class="account"><a href="#ax" id="rockfish_session_user_id">&nbsp;</a></li>
                            <li class="btns"><a href="#ax" class="AXButton" id="logoutButton"><i class="axi axi-power-off"></i> Logout</a></li>
                        </ul>
                        <div class="mx-loginfo"><a id="mx-loginfo-handle" class="mx-menu-button"><i class="axi axi-bars"></i></a></div>
                    </div>
                </div>
                <div class="ax-clear"></div>
            </div>
        </div>
    </div>
    <div class="H60"></div>
    <!-- ax-header : include -->

	<div class="ax-body">
		<div class="ax-wrap">

			<div class="ax-layer ax-title">
				<div class="ax-col-12 ax-content">
					<h1>Rockfish Dashboard</h1>
					<!-- <p class="desc">Rockfish DashBoard</p> -->
				</div>
				<div class="ax-clear"></div>
			</div>

			<div class="ax-layer">
				<div class="ax-col-12 ax-content">

					<!-- s.CXPage -->
					<div id="CXPage">
						<div class="ax-layer">
							<div class="ax-col-6">
								<div class="ax-unit">
									<div class="ax-box sample-01">
										<div class="ax-box-wrap" style="text-align:center">
											<h3>
												Top 5 - App Service Call (1Week)
												<!-- <a href="#" class="more">more <i class="axi axi-external-link-square"></i></a> -->
											</h3>
											<table cellpadding="0" cellspacing="0" class="AXGridTable">
												<colgroup>
													<col width="20%" />
													<col width="50%" />
													<col width="30%" />
												</colgroup>
												<thead>
												<tr>
													<td style="text-align:center">
														<div class="tdRel">
															App
														</div>
													</td>
													<td style="text-align:center">
														<div class="tdRel">
															Count
														</div>
													</td>
													<td style="text-align:center">
														<div class="tdRel">
															Top 5 Call Rate
														</div>
													</td>
												</tr>
												</thead>
												<tbody>
												<tr class="red">
													<td style="text-align:left" id="appA0">&nbsp;</td>
													<td style="text-align:right" id="appB0">&nbsp;</td>
													<td style="text-align:right" id="appC0">&nbsp;</td>
												</tr>
												<tr class="blue">
													<td style="text-align:left" id="appA1">&nbsp;</td>
													<td style="text-align:right" id="appB1">&nbsp;</td>
													<td style="text-align:right" id="appC1">&nbsp;</td>
												</tr>
												<tr class="green">
													<td style="text-align:left" id="appA2">&nbsp;</td>
													<td style="text-align:right" id="appB2">&nbsp;</td>
													<td style="text-align:right" id="appC2">&nbsp;</td>
												</tr>
												<tr class="gray">
													<td style="text-align:left" id="appA3">&nbsp;</td>
													<td style="text-align:right" id="appB3">&nbsp;</td>
													<td style="text-align:right" id="appC3">&nbsp;</td>
												</tr>
												<tr>
													<td style="text-align:left" id="appA4">&nbsp;</td>
													<td style="text-align:right" id="appB4">&nbsp;</td>
													<td style="text-align:right" id="appC4">&nbsp;</td>
												</tr>
												<tr>
													<td style="text-align:left" colspan="3">&nbsp;</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
									<div class="ax-clear"></div>
									<div class="H20"></div>
								</div>
							</div>
							<div class="ax-col-6">
								<div class="ax-unit">
									<div class="ax-box">
										<div class="ax-box-wrap" style="text-align:center">
											<h3>
												Service Call Summary (1Week)
												<!-- <a href="#" class="more">more <i class="axi axi-external-link-square"></i></a> -->
											</h3>
											<div id="page-grid-box"></div>
										</div>
									</div>
									<div class="ax-clear"></div>
									<div class="H20"></div>
								</div>
							</div>
							<div class="ax-clear"></div>
						</div>

						<div class="ax-layer">
							<div class="ax-col-6">
								<div class="ax-unit">
									<div class="ax-box">
										<div class="ax-box-wrap" style="text-align:center">
											<h3>
												Service Call Result (1Week)
												<!-- <a href="#" class="more">more <i class="axi axi-external-link-square"></i></a> -->
											</h3>
											<canvas id="chart-canvas-doughnut" height="150" style="min-height: 150px;"></canvas>
										</div>
									</div>
									<div class="ax-clear"></div>
									<div class="H20"></div>
								</div>
							</div>
							<div class="ax-col-6">
								<div class="ax-unit">
									<div class="ax-box">
										<div class="ax-box-wrap" style="text-align:center">
											<h3>
												Service Call History (1Week)
												<!-- <a href="#" class="more">more <i class="axi axi-external-link-square"></i></a> -->
											</h3>
											<canvas id="chart-canvas-line" height="150" style="min-height: 150px;"></canvas>
										</div>
									</div>
									<div class="ax-clear"></div>
									<div class="H20"></div>
								</div>
							</div>
							<div class="ax-clear"></div>
						</div>
					</div>
					<!-- e.CXPage -->

				</div>
				<div class="ax-clear"></div>
			</div>

		</div>
	</div>
    <!-- e ax-body -->

    <!-- ax-left : include -->
    <div class="ax-aside">
        <div class="ax-layer ax-aside-menu-box">
            <a class="ax-aside-menu"><i class="axi axi-angle-double-right fa-lg"></i><i class="axi axi-angle-double-left fa-lg"></i></a>
        </div>
        <div class="ax-layer ax-aside-box">
            <div class="ax-unit">
                <div class="ax-box">
                    <h3>MENU</h3>
                    <ul class="ax-aside-ul" id="ax-aside-ul"></ul>
                </div>
            </div>
        </div>
    </div>
    <!-- ax-left : include -->

    <!-- ax-footer : include -->
    <div class="ax-footer">
        <div class="ax-wrap">
            <div class="ax-col-6">
                <div class="ax-unit">
                    <ul class="ax-version">
                        <li><a href="https://github.com/devsunset/rockfish" target="_blank"><i class="axi axi-github-square"></i>Rockfish Console</a></li>
                        <li><i class="axi axi-check-circle-o"></i> ver. 0.1</li>
                        <li><select id="theme-select"></select></li>
                    </ul>
                </div>
            </div>
            <div class="ax-col-6">
                <div class="ax-unit">
                    <ul class="ax-funcs">
                    	<li>logo Icons made by <a href="http://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></li>
                        <li><a href="https://www.axisj.com" target="_blank"><i class="axi axi-axisj"></i> AXISJ.com</a></li>
                        <li><a href="https://github.com/axisj" target="_blank"><i class="axi axi-github-square"></i> AXISJ gitHub</a></li>
                        <li><a href="https://www.facebook.com/axisj" target="_blank"><i class="axi axi-facebook-square"></i> Facebook</a></li>
                    </ul>
                </div>
            </div>
            <div class="ax-clear"></div>
        </div>
    </div>   
    <!-- ax-footer : include -->
</div>
<script type="text/javascript">
	var page_menu_id = "m01"; // admin.js > topMenu_data 에 정의된 id
</script>
<script type="text/javascript">
	var fnObj = {
		pageStart: function(){
			//Session Check
            var url = '/console/sessionCheck'
            var pars = new Object();
             new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
                    if(res.rockfish_result_code == "S"){
                    	$("#rockfish_session_user_id").html(res.rockfish_result_data.user_name);
                    }else{
                       AXUtil.alert("Session is invalid or Session is time out.");
                       document.location.href="/index.html";
                    }
                },
                onerr:function(res){
                    toast.push("Session Check Error.");
                }
            });

            $('#logoutButton').click(function(){
                if(AXUtil.confirm('Do you want log out ?')){
                    var url = "/console/logout";
                    var pars = new Object();
                    new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
                           document.location.href="index.html";
                        },
                        onerr:function(res){
                            AXUtil.alert("Log out process error");
                        }
                    });
                }
            });     

			this.grid.bind();
			this.chart.serviceResult();
			this.chart.serviceHistory();
		},
		grid: {
			target: new AXGrid(),
			get: function(){ return this.target },
			bind: function(){

				this.target.setConfig({
					targetID : "page-grid-box",
					theme : "AXGrid",
					height: 218,
					mediaQuery: {
						mx:{min:0, max:767}, dx:{min:767}
					},
					colGroup : [
						{key:"NO", label:"No", width:"40", align:"center", formatter:"money"},
						{key:"APP", label:"App", width:"120"},
						{key:"SERVICE", label:"Service", width:"350", align:"left"},
						{key:"COUNT", label:"Count", width:"120", align:"right"}
					],
					page:{
						paging:false,
						pageNo:1,
						pageSize:100,
						status:{formatter: null}
					}
				});

				var url = '/console/dashboardTop5AppInfo'
		        var pars = new Object();
		         new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
		                if(res.rockfish_result_code == "S"){
		                	if(res !=null && res.list !== undefined && res.list.length > 0){
		                		var total = 0;
		                		for(var x=0;x<res.list.length;x++){
		                			total += parseInt(res.list[x].count);
		                		}

		                		for(var x=0;x<res.list.length;x++){
		                			$("#appA"+x).html(res.list[x].groupkey);
		                			$("#appB"+x).html(res.list[x].count.money());
		                			$("#appC"+x).html((res.list[x].count/total*100).toFixed(2)+'%');
		                		}
		                	}
		                }else if(res.rockfish_result_code == "X"){
		                   //skip
		                }else{
		                   AXUtil.alert(res.rockfish_result_msg);
		                }
		            },
		            onerr:function(res){
		                toast.push("Server Error.");
		            }
		        });


		        var url = '/console/dashboardServiceInfo'
		        var pars = new Object();
		         new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
		                if(res.rockfish_result_code == "S"){
		                	if(res !=null && res.list !== undefined && res.list.length > 0){
		                		var jdata = new Array();
		    					for(var x=0;x<res.list.length;x++){
		    						var obj = new Object();
		    						obj.NO = x+1;
		    						obj.APP = res.list[x].groupkey.app; 
		    						obj.SERVICE = res.list[x].groupkey.service; 
		    						obj.COUNT = res.list[x].count.money(); 
		    						jdata.push(obj);
		                		}
		                		fnObj.grid.target.setList(jdata);
		                	}
		                }else if(res.rockfish_result_code == "X"){
		                	// skip
		                }else{
		                   AXUtil.alert(res.rockfish_result_msg);
		                }
		            },
		            onerr:function(res){
		                toast.push("Server Error.");
		            }
		        });
			}
		},
		chart:{
			serviceResult: function(){
				var url = '/console/dashboardServiceResultInfo'
		        var pars = new Object();
		         new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
		                if(res.rockfish_result_code == "S"){
		                	if(res !=null && res.list !== undefined && res.list.length > 0){
		                		var eCount = 0;
		                		var sCount = 0;

		                		for(var x=0;x<res.list.length;x++){

		                			if(res.list[x].groupkey == "S"){
		                				sCount = res.list[x].count;
		                			}else if(res.list[x].groupkey == "E"){
		                				eCount = res.list[x].count;
		                			}
		                		}

		                		var doughnutData = [
									{
										value: eCount,
										color:"#F7464A",
										highlight: "#FF5A5E",
										label: "Fail"
									},
									{
										value: sCount,
										color: "#46BFBD",
										highlight: "#5AD3D1",
										label: "Success"
									}
								];

								var chart_doughnut = document.getElementById("chart-canvas-doughnut").getContext("2d");
								window.myChart_doughnut = new Chart(chart_doughnut).Doughnut(doughnutData, {
									responsive : true
								});
								
		                	}else{
		                		var canvas = document.getElementById("chart-canvas-doughnut");
								var ctx = canvas.getContext("2d");
								ctx.font = "30px Comic Sans MS";
								ctx.fillStyle = "gray";
								ctx.textAlign = "center";
								ctx.fillText("No data not found.", canvas.width/2, canvas.height/2); 
		                	}
		                }else if(res.rockfish_result_code == "X"){
		                	// skip
		                }else{
		                	var canvas = document.getElementById("chart-canvas-doughnut");
							var ctx = canvas.getContext("2d");
							ctx.font = "30px Comic Sans MS";
							ctx.fillStyle = "gray";
							ctx.textAlign = "center";
							ctx.fillText("No data not found.", canvas.width/2, canvas.height/2); 

		                   AXUtil.alert(res.rockfish_result_msg);
		                }
		            },
		            onerr:function(res){
		                toast.push("Server Error.");
		            }
		        });

			},
			serviceHistory: function(){
				var url = '/console/dashboardServiceHistoryInfo'
		        var pars = new Object();
		         new AXReq(url, {debug:false,type: "post", pars:pars, onsucc:function(res){
		                if(res.rockfish_result_code == "S"){
		                	if(res !=null && res.list !== undefined && res.list.length > 0){

	                			var xdateArr = new Array();
	                			for(var x=6;x > 0 ; x--){
	                				var sDate = new Date();
    								sDate.setTime(sDate.getTime()-1000*60*60*24*x);
    								xdateArr.push(sDate.date().print());
	                			}

	                			var nowDate = new Date();
    							xdateArr.push(nowDate.date().print());

	                			var dataArray = new Array();
	                			for(var x=0;x<xdateArr.length;x++){
	                				var count = 0;
	                				for(var z=0;z<res.list.length;z++){
	                					if(xdateArr[x] == res.list[z].groupkey){
	                						count = res.list[z].count;
	                						break;
	                					}
	                				}
	                				dataArray.push(count);
	                			}

								var lineChartData = {
									labels : xdateArr,
									datasets : [
										{
											label: "My Second dataset",
											fillColor : "rgba(151,187,205,0.2)",
											strokeColor : "rgba(151,187,205,1)",
											pointColor : "rgba(151,187,205,1)",
											pointStrokeColor : "#fff",
											pointHighlightFill : "#fff",
											pointHighlightStroke : "rgba(151,187,205,1)",
											data : dataArray
										}
									]

								};

								var chart_line = document.getElementById("chart-canvas-line").getContext("2d");
								window.myChart_line = new Chart(chart_line).Line(lineChartData, {
									responsive : true
								});
								
		                	}else{
		                		var canvas = document.getElementById("chart-canvas-line");
								var ctx = canvas.getContext("2d");
								ctx.font = "30px Comic Sans MS";
								ctx.fillStyle = "gray";
								ctx.textAlign = "center";
								ctx.fillText("No data not found.", canvas.width/2, canvas.height/2); 
		                	}
		                }else if(res.rockfish_result_code == "X"){
		                	// skip
		                }else{
		                	var canvas = document.getElementById("chart-canvas-line");
							var ctx = canvas.getContext("2d");
							ctx.font = "30px Comic Sans MS";
							ctx.fillStyle = "gray";
							ctx.textAlign = "center";
							ctx.fillText("No data not found.", canvas.width/2, canvas.height/2); 

		                   AXUtil.alert(res.rockfish_result_msg);
		                }
		            },
		            onerr:function(res){
		                toast.push("Server Error.");
		            }
		        });
				
			}
		}
	}
</script>

</body>
</html>